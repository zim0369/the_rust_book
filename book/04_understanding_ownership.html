<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Understanding Ownership                                   </title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="01_getting_started.html"><strong aria-hidden="true">1.</strong> Getting Started                                           </a></li><li class="chapter-item expanded "><a href="02_programming_a_guessing_game.html"><strong aria-hidden="true">2.</strong> Programming A Guessing Game                               </a></li><li class="chapter-item expanded "><a href="03_common_programming_concepts.html"><strong aria-hidden="true">3.</strong> Common Programming Concepts                               </a></li><li class="chapter-item expanded "><a href="04_understanding_ownership.html" class="active"><strong aria-hidden="true">4.</strong> Understanding Ownership                                   </a></li><li class="chapter-item expanded "><a href="05_using_structs_to_structure_related_data.html"><strong aria-hidden="true">5.</strong> Using Structs To Structure Related Data                   </a></li><li class="chapter-item expanded "><a href="06_enums_and_pattern_matching.html"><strong aria-hidden="true">6.</strong> Enums And Pattern Matching                                </a></li><li class="chapter-item expanded "><a href="07_managing_growing_projects_with_packages_crates_and_modules.html"><strong aria-hidden="true">7.</strong> Managing Growing Projects With Packages Crates And Modules</a></li><li class="chapter-item expanded "><a href="08_common_collections.html"><strong aria-hidden="true">8.</strong> Common Collections                                        </a></li><li class="chapter-item expanded "><a href="09_error_handling.html"><strong aria-hidden="true">9.</strong> Error Handling                                            </a></li><li class="chapter-item expanded "><a href="10_generic_types_traits_and_lifetimes.html"><strong aria-hidden="true">10.</strong> Generic Types Traits And Lifetimes                        </a></li><li class="chapter-item expanded "><a href="11_writing_automated_tests.html"><strong aria-hidden="true">11.</strong> Writing Automated Tests                                   </a></li><li class="chapter-item expanded "><a href="12_an_io_project.html"><strong aria-hidden="true">12.</strong> An Io Project                                             </a></li><li class="chapter-item expanded "><a href="13_functional_language_features.html"><strong aria-hidden="true">13.</strong> Functional Language Features                              </a></li><li class="chapter-item expanded "><a href="14_more_about_cargo_and_crates.io.html"><strong aria-hidden="true">14.</strong> More About Cargo And Crates.io                            </a></li><li class="chapter-item expanded "><a href="15_smart_pointers.html"><strong aria-hidden="true">15.</strong> Smart Pointers                                            </a></li><li class="chapter-item expanded "><a href="16_fearless_concurrency.html"><strong aria-hidden="true">16.</strong> Fearless Concurrency                                      </a></li><li class="chapter-item expanded "><a href="17_object_oriented_programming_features_of_rust.html"><strong aria-hidden="true">17.</strong> Object Oriented Programming Features Of Rust              </a></li><li class="chapter-item expanded "><a href="18_patterns_and_matching.html"><strong aria-hidden="true">18.</strong> Patterns And Matching                                     </a></li><li class="chapter-item expanded "><a href="19_advanced_features.html"><strong aria-hidden="true">19.</strong> Advanced Features                                         </a></li><li class="chapter-item expanded "><a href="20_final_project.html"><strong aria-hidden="true">20.</strong> Final Project                                             </a></li><li class="chapter-item expanded "><a href="21_appendix.html"><strong aria-hidden="true">21.</strong> Appendix                                                  </a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="understanding-ownership"><a class="header" href="#understanding-ownership">Understanding Ownership</a></h1>
<ul>
<li>Pushing to the stack is faster than allocating on the heap</li>
<li>Accessing data in the heap is slower than accessing data on the stack because you have to follow a pointer to get there</li>
<li>When your code calls a function, the values passed into the function (including, potentially, pointers to data on the heap) and the function’s local variables get pushed onto the stack. When the function is over, those values get popped off the stack.</li>
<li>There can only be one owner of a value at a time</li>
<li>When owner goes out of scope, the value will be dropped</li>
</ul>
<h2 id="the-string-type"><a class="header" href="#the-string-type">The String Type</a></h2>
<ul>
<li>
<p>We use string literals(str) to store data that is known at compile time else we use the &quot;String&quot; type</p>
</li>
<li>
<p><code>String</code> can be mutated but not literals</p>
</li>
<li>
<p>With the String type, in order to support a mutable, growable piece of text, we need to allocate an amount of memory on the heap, unknown at compile time, to hold the contents. This means:</p>
<ul>
<li>The memory must be requested from the memory allocator at runtime.</li>
<li>We need a way of returning this memory to the allocator when we’re done with our String.</li>
<li>That first part is done by us: when we call String::from, its implementation requests the memory it needs.</li>
</ul>
</li>
<li>
<p>Common Methods</p>
<ul>
<li><code>variable.push_str(&quot;, world!&quot;);</code></li>
</ul>
<!-- TODO: Add more -->
</li>
<li>
<p>Let's look at the ways variables and data interact</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let s1 = String::from(&quot;hello&quot;);
    let s2 = s1;
}
</code></pre></pre>
</li>
<li>
<p>This is how the memory representation looks like for:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let s1 = String::from(&quot;hello&quot;);
<span class="boring">}
</span></code></pre></pre>
<p><img src="images/04/s1_heap.png" alt="s1 points to data on heap" /></p>
</li>
<li>
<p>This is how the memory representation would look like if you clone <code>s1</code> i.e.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let s2 = s1.clone()
<span class="boring">}
</span></code></pre></pre>
<p><img src="images/04/clone_s1.png" alt="s2 is a copy of s1" /></p>
</li>
<li>
<p>If the memory representation looked like below then that would be a bug. When one of the variables goes out of scope and the value is dropped, the other variable would still be pointing at that value which was dropped.</p>
<p><img src="images/04/double_free_error.png" alt="Double Free Error" /></p>
</li>
<li>
<p>The correct memory representation would like like this instead. <code>s1</code> is moved into <code>s2</code> and is no longer valid.</p>
<p><img src="images/04/moved_to_s2.png" alt="s1 moved into s2" /></p>
</li>
<li>
<p>Scalar types like <code>bool</code>, <code>u32</code>, <code>(u32, f64)</code>, etc. implement the <code>Copy</code> trait.</p>
</li>
<li>
<p>The code below works and <code>x</code> wasn't moved into <code>y</code> because the size of types like integers is known at compile time so they are stored on stack.</p>
</li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">fn main() {
</span>    let x = 5;
    let y = x;

    println!(&quot;x = {}, y = {}&quot;, x, y);
<span class="boring">}
</span></code></pre></pre>
<h2 id="ownership-and-functions"><a class="header" href="#ownership-and-functions">Ownership and Functions</a></h2>
<p>The mechanics of passing a value to a function are similar to those when assigning a value to a variable.</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let s1 = gives_ownership();         // gives_ownership moves its return
                                        // value into s1

    let s2 = String::from(&quot;hello&quot;);     // s2 comes into scope

    let s3 = takes_and_gives_back(s2);  // s2 is moved into
                                        // takes_and_gives_back, which also
                                        // moves its return value into s3
} // Here, s3 goes out of scope and is dropped. s2 was moved, so nothing
  // happens. s1 goes out of scope and is dropped.

fn gives_ownership() -&gt; String {             // gives_ownership will move its
                                             // return value into the function
                                             // that calls it

    let some_string = String::from(&quot;yours&quot;); // some_string comes into scope

    some_string                              // some_string is returned and
                                             // moves out to the calling
                                             // function
}

// This function takes a String and returns one
fn takes_and_gives_back(a_string: String) -&gt; String { // a_string comes into
                                                      // scope

    a_string  // a_string is returned and moves out to the calling function
}
</code></pre></pre>
<h2 id="references-and-borrowing"><a class="header" href="#references-and-borrowing">References and Borrowing</a></h2>
<ul>
<li>All references are stored on the stack <!-- TODO: Check if this statement is correct --></li>
<li>Unlike a pointer, a reference is guaranteed to point to a valid value of a particular type for the life of that reference.</li>
</ul>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let s1 = String::from(&quot;hello&quot;);

    let len = calculate_length(&amp;s1);

    println!(&quot;The length of '{}' is {}.&quot;, s1, len);
}

fn calculate_length(s: &amp;String) -&gt; usize { // s is a reference to a String
    s.len()
} // Here, s goes out of scope. But because it does not have ownership of what
  // it refers to, it is not dropped.
</code></pre></pre>
<ul>
<li>The memory representation for the above code looks like:</li>
</ul>
<p><img src="images/04/reference.png" alt="s points to s1" /></p>
<ul>
<li>
<p>We will look at dereferencing(<code>*</code>) in later chapters <!-- TODO: Add a link to the dereference operator chapter --></p>
</li>
<li>
<p>To modify a borrowed value, make a reference mutable</p>
</li>
<li>
<p><a href="https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html#mutable-references">This Section</a> from the book marks the point of confusion</p>
</li>
<li>
<p>If you have a mutable reference to a value, you can have no other references to that value.</p>
</li>
</ul>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let mut s = String::from(&quot;hello&quot;);

    let r1 = &amp;mut s;
    let r2 = &amp;mut s;

    println!(&quot;{}, {}&quot;, r1, r2);
}
</code></pre></pre>
<p>Error:</p>
<pre><code class="language-console">$ cargo run
   Compiling ownership v0.1.0 (file:///projects/ownership)
error[E0499]: cannot borrow `s` as mutable more than once at a time
 --&gt; src/main.rs:5:14
  |
4 |     let r1 = &amp;mut s;
  |              ------ first mutable borrow occurs here
5 |     let r2 = &amp;mut s;
  |              ^^^^^^ second mutable borrow occurs here
6 |
7 |     println!(&quot;{}, {}&quot;, r1, r2);
  |                        -- first borrow later used here

For more information about this error, try `rustc --explain E0499`.
error: could not compile `ownership` due to previous error
</code></pre>
<p>The benefit of having this restriction is that Rust can prevent data races at compile time. A data race is similar to a race condition and happens when these three behaviors occur:</p>
<ul>
<li>Two or more pointers access the same data at the same time.</li>
<li>At least one of the pointers is being used to write to the data.</li>
<li>There’s no mechanism being used to synchronize access to the data.</li>
</ul>
<p>As always, we can use curly brackets to create a new scope, allowing for multiple mutable references, just not simultaneous ones:</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let mut s = String::from(&quot;hello&quot;);

    {
        let r1 = &amp;mut s;
    } // r1 goes out of scope here, so we can make a new reference with no problems.

    let r2 = &amp;mut s;
}
</code></pre></pre>
<p>Rust enforces a similar rule for combining mutable and immutable references.</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let mut s = String::from(&quot;hello&quot;);

    let r1 = &amp;s; // no problem
    let r2 = &amp;s; // no problem
    let r3 = &amp;mut s; // BIG PROBLEM

    println!(&quot;{}, {}, and {}&quot;, r1, r2, r3);
}
</code></pre></pre>
<p>Error:</p>
<pre><code class="language-console">$ cargo run
   Compiling ownership v0.1.0 (file:///projects/ownership)
error[E0502]: cannot borrow `s` as mutable because it is also borrowed as immutable
 --&gt; src/main.rs:6:14
  |
4 |     let r1 = &amp;s; // no problem
  |              -- immutable borrow occurs here
5 |     let r2 = &amp;s; // no problem
6 |     let r3 = &amp;mut s; // BIG PROBLEM
  |              ^^^^^^ mutable borrow occurs here
7 |
8 |     println!(&quot;{}, {}, and {}&quot;, r1, r2, r3);
  |                                -- immutable borrow later used here

For more information about this error, try `rustc --explain E0502`.
error: could not compile `ownership` due to previous error
</code></pre>
<p>Whew! We also cannot have a mutable reference while we have an immutable one to the same value.</p>
<p>Users of an immutable reference don’t expect the value to suddenly change out from under them! However, multiple immutable references are allowed because no one who is just reading the data has the ability to affect anyone else’s reading of the data.</p>
<p>Note that a reference’s scope starts from where it is introduced and continues through the last time that reference is used. So this code compiles:</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let mut s = String::from(&quot;hello&quot;);

    let r1 = &amp;s; // no problem
    let r2 = &amp;s; // no problem
    println!(&quot;{} and {}&quot;, r1, r2);
    // variables r1 and r2 will not be used after this point

    let r3 = &amp;mut s; // no problem
    println!(&quot;{}&quot;, r3);
}
</code></pre></pre>
<h2 id="dangling-references"><a class="header" href="#dangling-references">Dangling References</a></h2>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let reference_to_nothing = dangle();
}

fn dangle() -&gt; &amp;String { // dangle returns a reference to a String

    let s = String::from(&quot;hello&quot;); // s is a new String

    &amp;s // we return a reference to the String, s
} // Here, s goes out of scope, and is dropped. Its memory goes away.
  // Danger!
</code></pre></pre>
<p>Error:</p>
<pre><code class="language-console">$ cargo run
   Compiling ownership v0.1.0 (file:///projects/ownership)
error[E0106]: missing lifetime specifier
 --&gt; src/main.rs:5:16
  |
5 | fn dangle() -&gt; &amp;String {
  |                ^ expected named lifetime parameter
  |
  = help: this function's return type contains a borrowed value, but there is no value for it to be borrowed from
help: consider using the `'static` lifetime
  |
5 | fn dangle() -&gt; &amp;'static String {
  |                ~~~~~~~~

For more information about this error, try `rustc --explain E0106`.
error: could not compile `ownership` due to previous error

</code></pre>
<p>More specifically:</p>
<pre><code class="language-console">this function's return type contains a borrowed value, but there is no value
for it to be borrowed from
</code></pre>
<h2 id="slice-type-different-kind-of-references"><a class="header" href="#slice-type-different-kind-of-references">Slice Type: Different kind of references</a></h2>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="03_common_programming_concepts.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="05_using_structs_to_structure_related_data.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="03_common_programming_concepts.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="05_using_structs_to_structure_related_data.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
